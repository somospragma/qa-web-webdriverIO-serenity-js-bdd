"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.activityFinished = activityFinished;
const core_1 = require("@serenity-js/core");
const mappers_1 = require("../mappers");
/**
 * @package
 */
function activityFinished(activityId, name, outcome, finishedAt) {
    return (context) => {
        const linkedStep = context.steps.get(activityId.value);
        const outcomeReport = (0, mappers_1.outcomeReportFrom)(outcome);
        linkedStep.step.description = name.value;
        linkedStep.step.result = outcomeReport.result;
        linkedStep.step.exception = outcomeReport.error;
        linkedStep.step.duration = core_1.Timestamp.fromJSON(linkedStep.step.startTime).diff(finishedAt).inMilliseconds();
        context.currentActivityId = linkedStep.parentActivityId;
        return context;
    };
}
//# sourceMappingURL=activityFinished.js.map